{% extends "base.html" %}
{% load static %}

{% block content %}
  {# 1. ê³µí†µ ê³ ì • ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ ë°” ì¸í´ë£¨ë“œ #}
  {% include "books/includes/sticky_category_nav.html" %}

<style>

  .home-page-content-wrapper {
    margin-top: 40px; /* ì„ì‹œ ê°’, ì‹¤ì œ sticky_category_navbarì˜ ë†’ì´ë¡œ ë³€ê²½í•˜ì„¸ìš”! */
  }

  .home-content-sections-wrapper { /* ê²€ìƒ‰ë°”, ë² ìŠ¤íŠ¸ì…€ëŸ¬ ë“± ì£¼ìš” ë‚´ìš©ì„ ê°ì‹¸ëŠ” ì¤‘ì•™ ì •ë ¬ ì»¨í…Œì´ë„ˆ */
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* ê²€ìƒ‰ë°” ìŠ¤íƒ€ì¼ (home.html ê³ ìœ  ìŠ¤íƒ€ì¼ë¡œ ìœ ì§€) */
  .search-bar {
    display: flex;
    justify-content: center;
    margin: 20px 0; /* ì´ì „ .home-container ë‚´ë¶€ì—ì„œì˜ marginê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ */
  }
  .search-bar input { width: 300px; padding: 10px; border-radius: 15px 0 0 15px; border: 1px solid #ccc; }
  .search-bar button { padding: 10px 15px; border: 1px solid #ccc; background-color: #eee; border-radius: 0 15px 15px 0; cursor: pointer; }

  /* ë² ìŠ¤íŠ¸ì…€ëŸ¬ í•„í„° íƒ­ ìŠ¤íƒ€ì¼ (home.html ê³ ìœ  ìŠ¤íƒ€ì¼ë¡œ ìœ ì§€) */
  .category-tabs {
    display: flex; gap: 10px; margin: 10px 0; background-color: #52b7b7;
    padding: 10px; border-radius: 8px; flex-wrap: wrap;
  }
  .category-tab {
    background-color: white; color: #52b7b7; border: none; padding: 10px 15px;
    border-radius: 8px; cursor: pointer; font-weight: bold;
  }

  /* ì±… ëª©ë¡ ê´€ë ¨ ìŠ¤íƒ€ì¼ (home.html ê³ ìœ  ìŠ¤íƒ€ì¼ë¡œ ìœ ì§€) */
  .bestseller-list, .book-grid {
    display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0;
  }
  .book-item, .book-card {
    background-color: #eee; padding: 10px; border-radius: 10px;
    width: 150px; text-align: center;
  }
  .book-item img, .book-card img {
    width: 100%; height: auto; border-radius: 5px;
  }

  /* ì„¹ì…˜ ë‚˜ëˆ„ê¸° ìŠ¤íƒ€ì¼ (home.html ê³ ìœ  ìŠ¤íƒ€ì¼ë¡œ ìœ ì§€) */
  .sections {
    display: flex; justify-content: space-between; gap: 20px; margin: 20px 0;
  }
  .section { flex: 1; }
  .review-placeholder { background-color: #eee; height: 200px; border-radius: 10px; padding: 20px; }

</style>

{# 2. í˜ì´ì§€ë³„ ì½˜í…ì¸ ëŠ” ìƒˆë¡œìš´ wrapper ì•ˆì— ë°°ì¹˜í•˜ì—¬ margin-top ì ìš© #}
<div class="home-page-content-wrapper">
  <div class="home-content-sections-wrapper"> {# ì´ì „ì˜ home-container ì—­í•  #}
    <div class="search-bar">
      <form action="{% url 'books:all_books_list' %}" method="GET" style="display: flex;">
          <input type="text" name="q" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          <button type="submit">ğŸ”</button>
      </form>
    </div>

    <h2>ë² ìŠ¤íŠ¸ì…€ëŸ¬</h2>
    <div class="bestseller-section">
      <div class="category-tabs">
        {# ì´ 'categories'ëŠ” views.homeì—ì„œ ì „ë‹¬í•˜ëŠ” ë² ìŠ¤íŠ¸ì…€ëŸ¬ í•„í„°ìš© ì¹´í…Œê³ ë¦¬ ëª©ë¡ì…ë‹ˆë‹¤. #}
        {# global_categories (ìƒë‹¨ ë„¤ë¹„ìš©)ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. #}
        {% for category_for_tab in categories %}
          <button class="category-tab" onclick="filterCategory('{{ category_for_tab.id }}')">
            {{ category_for_tab.display_name }} {# ë˜ëŠ” category_for_tab.name #}
          </button>
        {% endfor %}
      </div>

      <div class="bestseller-list" id="bestseller-list">
      {% for book in bestseller_books %}
        <div class="book-item">
          <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
          <p>{{ book.title }}</p>
          <a href="{% url 'books:book_detail' book_id=book.id %}" class="detail-link">ìì„¸íˆ</a>
        </div>
      {% endfor %}
      </div>
    </div>

    <div class="sections">
      <section class="section new-books">
        <h2>ì‹ ê°„</h2>
        <div class="book-grid">
          {% for book in new_books %}
            <div class="book-card">
              <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
              <p>{{ book.title }}</p>
              <a href="{% url 'books:book_detail' book_id=book.id %}" class="detail-link">ìì„¸íˆ</a>
            </div>
          {% endfor %}
        </div>
      </section>

      <section class="section reviews">
        <h2>ì‹¤ì‹œê°„ ë¦¬ë·°</h2>
        <div class="review-placeholder">
          ë¦¬ë·° ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
      </section>
    </div>
  </div> {# End of home-content-sections-wrapper #}
</div> {# End of home-page-content-wrapper #}

<script>
  const allBooks = [
    {% for book in bestseller_books %}
    {
      id: '{{ book.id }}',
      category_id: '{{ book.category.id }}',
      title: '{{ book.title|escapejs }}',
      cover_image_url: '{{ book.cover_image_url|escapejs }}',
      detail_url: '{% url "books:book_detail" book_id=book.id %}'
    },
    {% endfor %}
  ];

  function filterCategory(categoryId) {
    const listDiv = document.getElementById('bestseller-list');
    listDiv.innerHTML = '';

    let filteredBooks;
    if (categoryId === 'all') { // 'all' ë²„íŠ¼ì´ ìˆë‹¤ë©´, í•´ë‹¹ IDë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ë³„ë„ ì²˜ë¦¬
      filteredBooks = allBooks;
    } else {
      filteredBooks = allBooks.filter(book => String(book.category_id) === String(categoryId));
    }

    if(filteredBooks.length === 0) {
      listDiv.innerHTML = '<p>í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ë² ìŠ¤íŠ¸ì…€ëŸ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }

    filteredBooks.forEach(book => {
      const bookDiv = document.createElement('div');
      bookDiv.className = 'book-item';
      bookDiv.innerHTML = `
        <img src="${book.cover_image_url}" alt="${book.title}">
        <p>${book.title}</p>
        <a href="${book.detail_url}" class="detail-link">ìì„¸íˆ</a> 
      `;
      listDiv.appendChild(bookDiv);
    });
  }
</script>
{% endblock content %}