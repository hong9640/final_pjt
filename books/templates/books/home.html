{% extends "base.html" %}

{% block content %}
<style>
  body {
    font-family: sans-serif;
    background-color: #fefaf5;
    margin: 0;
    padding: 0;
  }

  .home-container {
    padding: 0;
  }

  .top-nav {
    background-color: #b08968;
    padding: 10px 20px;
    margin-bottom: 20px;
  }

  .top-nav ul {
    list-style: none;
    display: flex;
    gap: 20px;
    margin: 0;
    padding: 0;
  }

  .top-nav a {
    text-decoration: none;
    color: black;
    font-weight: bold;
  }

  .search-bar {
    display: flex;
    justify-content: center;
    margin: 20px 0;
  }

  .search-bar input {
    width: 300px;
    padding: 10px;
    border-radius: 15px 0 0 15px;
    border: 1px solid #ccc;
  }

  .search-bar button {
    padding: 10px 15px;
    border: 1px solid #ccc;
    background-color: #eee;
    border-radius: 0 15px 15px 0;
    cursor: pointer;
  }

  .category-tabs {
    display: flex;
    gap: 10px;
    margin: 10px 0;
    background-color: #52b7b7;
    padding: 10px;
    border-radius: 8px;
    flex-wrap: wrap;
  }

  .category-tab {
    background-color: white;
    color: #52b7b7;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  .bestseller-list, .book-grid {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin: 20px 0;
  }

  .book-item, .book-card {
    background-color: #eee;
    padding: 10px;
    border-radius: 10px;
    width: 150px;
    text-align: center;
  }

  .book-item img, .book-card img {
    width: 100%;
    height: auto;
    border-radius: 5px;
  }

  .sections {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin: 20px 0;
  }

  .section {
    flex: 1;
  }

  .review-placeholder {
    background-color: #eee;
    height: 200px;
    border-radius: 10px;
    padding: 20px;
  }
</style>

<div class="home-container">
  <!-- 상단 갈색 바 -->
  <nav class="top-nav">
    <ul>
      <li><a href="#">전체</a></li>
      {% for category in categories %}
        <li><a href="#">{{ category.name }}</a></li>
      {% endfor %}
    </ul>
  </nav>

  <!-- 검색바 -->
  <div class="search-bar">
    <input type="text" placeholder="검색어를 입력하세요">
    <button type="submit">🔍</button>
  </div>
</div>

  <!-- 베스트셀러 -->
  <h2>베스트셀러</h2>
  <div class="bestseller-section">
    <div class="category-tabs">
      {% for category in categories %}
        <button class="category-tab" onclick="filterCategory('{{ category.id }}')">
          {{ category.display_name }}
        </button>
      {% endfor %}
    </div>

    <div class="bestseller-list" id="bestseller-list">
    {% for book in bestseller_books %}
      <div class="book-item">
        <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
        <p>{{ book.title }}</p>
        <a href="{% url 'books:book_detail' book_id=book.id %}" class="detail-link">자세히</a>
      </div>
    {% endfor %}
  </div>
  </div>

  <!-- 신간 + 실시간 리뷰 -->
  <div class="sections">
    <!-- 신간 -->
    <section class="section new-books">
      <h2>신간</h2>
      <div class="book-grid">
        {% for book in new_books %}
          <div class="book-card">
            <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
            <p>{{ book.title }}</p>
            <a href="{% url 'books:book_detail' book_id=book.id %}" class="detail-link">자세히</a>
          </div>
        {% endfor %}
      </div>
    </section>

    <!-- 실시간 리뷰 자리 -->
    <section class="section reviews">
      <h2>실시간 리뷰</h2>
      <div class="review-placeholder">
        리뷰 내용이 여기에 표시됩니다.
      </div>
    </section>
  </div>
  <script>
  const allBooks = [
    {% for book in bestseller_books %}
    {
      id: '{{ book.id }}',
      category_id: '{{ book.category.id }}',
      title: '{{ book.title|escapejs }}',
      cover_image_url: '{{ book.cover_image_url|escapejs }}'
    },
    {% endfor %}
  ];

  function filterCategory(categoryId) {
    const listDiv = document.getElementById('bestseller-list');
    listDiv.innerHTML = '';

    let filteredBooks;
    if (categoryId === 'all') {
      filteredBooks = allBooks;
    } else {
      filteredBooks = allBooks.filter(book => book.category_id === categoryId);
    }

    if(filteredBooks.length === 0) {
      listDiv.innerHTML = '<p>해당 카테고리의 베스트셀러가 없습니다.</p>';
      return;
    }

    filteredBooks.forEach(book => {
      const bookDiv = document.createElement('div');
      bookDiv.className = 'book-item';
      bookDiv.innerHTML = `
        <img src="${book.cover_image_url}" alt="${book.title}">
        <p>${book.title}</p>
      `;
      listDiv.appendChild(bookDiv);
    });
  }
</script>
        {% endblock content %}
