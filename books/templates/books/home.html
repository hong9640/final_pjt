{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block content %}
{% include "books/includes/sticky_category_nav.html" %}

<style>
  .home-page-content-wrapper {
    margin-top: 40px;
  }

  .home-content-sections-wrapper {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .search-bar {
    display: flex;
    justify-content: center;
    margin: 20px 0;
  }

  .search-bar input {
    width: 300px;
    padding: 10px;
    border-radius: 15px 0 0 15px;
    border: 1px solid #ccc;
  }

  .search-bar button {
    padding: 10px 15px;
    border: 1px solid #ccc;
    background-color: #eee;
    border-radius: 0 15px 15px 0;
    cursor: pointer;
  }

  .category-tabs {
    display: flex;
    gap: 10px;
    margin: 10px 0;
    background-color: #52b7b7;
    padding: 10px;
    border-radius: 8px;
    flex-wrap: wrap;
  }

  .category-tab {
    background-color: white;
    color: #52b7b7;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  .bestseller-list, .book-group {
    display: none;
    flex-wrap: wrap;
    gap: 20px;
    margin: 20px 0;
  }

  .book-item, .book-card {
    background-color: #eee;
    padding: 10px;
    border-radius: 10px;
    width: 150px;
    text-align: center;
  }

  .book-item img, .book-card img {
    width: 100%;
    height: auto;
    border-radius: 5px;
  }

  .sections {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin: 20px 0;
  }

  .section {
    flex: 1;
  }

  .review-placeholder {
    background-color: #eee;
    height: 200px;
    border-radius: 10px;
    padding: 20px;
  }
</style>

<div class="home-page-content-wrapper">
  <div class="home-content-sections-wrapper">
    <div class="search-bar">
      <form action="{% url 'books:all_books_list' %}" method="GET" style="display: flex;">
        <input type="text" name="q" placeholder="검색어를 입력하세요">
        <button type="submit">🔍</button>
      </form>
    </div>

    <h2>베스트셀러</h2>
    <div class="bestseller-section">
      <div class="category-tabs">
        {% for group_name in bestseller_groups %}
          {% with slug=group_name|slugify_filter %}
            {% if slug %}
              <button class="category-tab" onclick="filterGroup('{{ slug }}')">{{ group_name }}</button>
            {% endif %}
          {% endwith %}
        {% endfor %}
      </div>

      <div id="bestseller-list">
        {% for group, books in grouped_bestsellers.items %}
          {% with slug=group|slugify_filter %}
            {% if slug %}
              <div class="book-group" data-group="{{ slug }}">
                {% for book in books %}
                  <div class="book-item">
                    <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
                    <p>{{ book.title }}</p>
                    <a href="{% url 'books:book_detail' book_id=book.id %}" class="detail-link">자세히</a>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          {% endwith %}
        {% endfor %}
      </div>
    </div>

    <div class="sections">
      <section class="section new-books">
        <h2>신간</h2>
        <div class="book-grid" style="display: flex; flex-wrap: wrap; gap: 20px;">
          {% for book in new_books %}
            <div class="book-card">
              <img src="{{ book.cover_image_url }}" alt="{{ book.title }}">
              <p>{{ book.title }}</p>
              <a href="{% url 'books:book_detail' book_id=book.id %}" class="detail-link">자세히</a>
            </div>
          {% endfor %}
        </div>
      </section>

      <section class="section reviews">
        <h2>실시간 리뷰</h2>
        <div class="review-placeholder">리뷰 내용이 여기에 표시됩니다.</div>
      </section>
    </div>
  </div>
</div>

<script>
  function filterGroup(groupSlug) {
    const groups = document.querySelectorAll('.book-group');
    groups.forEach(group => {
      group.style.display = (group.dataset.group === groupSlug) ? 'flex' : 'none';
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const firstGroup = document.querySelector('.book-group');
    if (firstGroup) firstGroup.style.display = 'flex';
  });
</script>
{% endblock content %}
